<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Running Jupyter Notebooks on Habanero - Research Computing in Earth Sciences</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./running-jupyter-notebooks-on-habanero.html">

        <meta name="author" content="Ryan Abernathey" />
        <meta name="keywords" content="habanero,parallel computing,cluster" />
        <meta name="description" content="Here we will learn how to launch a jupyter notebook on Habanero and connect to it via an ssh tunnel. It would be possible to automate all of this, but it is instructive to go through the steps manually. Login Login to Habanero by using the ssh command in a …" />

        <meta property="og:site_name" content="Research Computing in Earth Sciences" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Running Jupyter Notebooks on Habanero"/>
        <meta property="og:url" content="./running-jupyter-notebooks-on-habanero.html"/>
        <meta property="og:description" content="Here we will learn how to launch a jupyter notebook on Habanero and connect to it via an ssh tunnel. It would be possible to automate all of this, but it is instructive to go through the steps manually. Login Login to Habanero by using the ssh command in a …"/>
        <meta property="article:published_time" content="2017-11-30" />
            <meta property="article:section" content="lectures" />
            <meta property="article:tag" content="habanero" />
            <meta property="article:tag" content="parallel computing" />
            <meta property="article:tag" content="cluster" />
            <meta property="article:author" content="Ryan Abernathey" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.lumen.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Research Computing in Earth Sciences            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/schedule.html">
                             Schedule
                          </a></li>
                         <li><a href="./pages/syllabus.html">
                             Syllabus
                          </a></li>
                        <li >
                            <a href="./category/assignments.html">Assignments</a>
                        </li>
                        <li class="active">
                            <a href="./category/lectures.html">Lectures</a>
                        </li>
                        <li >
                            <a href="./category/software.html">Software</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./running-jupyter-notebooks-on-habanero.html"
                       rel="bookmark"
                       title="Permalink to Running Jupyter Notebooks on Habanero">
                        Running Jupyter Notebooks on Habanero
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-11-30T00:00:00-05:00"> Thu 30 November 2017</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/habanero.html">habanero</a>
        /
	<a href="./tag/parallel-computing.html">parallel computing</a>
        /
	<a href="./tag/cluster.html">cluster</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Here we will learn how to launch a jupyter notebook on Habanero and connect to it via an ssh tunnel.
It would be possible to automate all of this, but it is instructive to go through the steps manually.</p>
<h3>Login</h3>
<p>Login to Habanero by using the <code>ssh</code> command in a unix shell:</p>
<div class="highlight"><pre><span></span>ssh &lt;UNI&gt;@habanero.rcs.columbia.edu
</pre></div>


<p>where you replace <code>&lt;UNI&gt;</code> with your UNI.</p>
<p>Check to see where your home directory is:</p>
<div class="highlight"><pre><span></span><span class="o">[</span>kwk2115@holmes ~<span class="o">]</span>$ <span class="nb">pwd</span>
/rigel/home/kwk2115
</pre></div>


<h3>Load Environment</h3>
<p>In the <a href="./introduction-to-the-habanero-hpc-cluster.html">Intro to Habanero</a>,
you configured an environment called <code>geo_scipy</code>. You should activate it again.</p>
<div class="highlight"><pre><span></span>$ module load anaconda
$ <span class="nb">source</span> activate geo_scipy
</pre></div>


<h3>Configure notebook security</h3>
<p>Jupyter notebook servers can include a password for security.
This step is especially important in a shared environment, to ensure that
other users can't access your notebook.
To create a password, first we generate the Jupyter config file</p>
<div class="highlight"><pre><span></span>jupyter notebook --generate-config
</pre></div>


<p>This created a file in <code>~/.jupyter/jupyter_notebook_config.py</code>.  If you open
that file and search for "password", you'll see a line like the following:</p>
<div class="highlight"><pre><span></span>#c.NotebookApp.password = u&#39;&#39;
</pre></div>


<p>The instructions in the comments of the config file tell you to generate a
hashed password by entering the following commands:</p>
<div class="highlight"><pre><span></span>$ ipython
</pre></div>


<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">notebook.auth</span> <span class="kn">import</span> <span class="n">passwd</span><span class="p">;</span> <span class="n">passwd</span><span class="p">()</span>
<span class="n">Enter</span> <span class="n">password</span><span class="p">:</span>
</pre></div>


<p>You can enter a password of your choice, and it will return to you a hashed
password that encodes the same information, but is safe to include in a
publicly accessible config file.  I entered "password" (do not do this) and go
the following output:</p>
<div class="highlight"><pre><span></span><span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s1">&#39;sha1:69a76df803b9:99ca27341563cd85ba4e78684128e1f4ad2d8d0d&#39;</span>
</pre></div>


<p>Copy that string into the clipboard, then open your <code>jupyter_notebook_config.py</code>
config file in a text editor (vim, nano, or emacs). Find the password line and
paste the hashed password.</p>
<div class="highlight"><pre><span></span>c.NotebookApp.password = u&#39;sha1:69a76df803b9:99ca27341563cd85ba4e78684128e1f4ad2d8d0d&#39;
</pre></div>


<p>Security is now configured for your notebook.</p>
<h3>Launch a notebook on a compute node</h3>
<p>You should not use the login nodes for any data analysis tasks. The jupyter
notebook needs to be launched on a compute node. We need to create a jobscript
that will allow us to launch a notebook. Open a text editor (vim, nano, emacs)
on a new filed called <code>launch-notebook.sh</code> and type in the following lines</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --account=edu</span>
<span class="c1">#SBATCH --reserverpation=edu_15</span>
<span class="c1">#SBATCH -J notebook</span>
<span class="c1">#SBATCH --time=6:00:00</span>


<span class="c1"># Setup Environment</span>
module load anaconda
<span class="nb">source</span> activate geo_scipy

<span class="nb">export</span> <span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

jupyter notebook --no-browser --ip <span class="s2">&quot;*&quot;</span> <span class="se">\</span>
  --notebook-dir <span class="nv">$HOME</span>
</pre></div>
</td></tr></table>

<p>Once this file has been created, use it to launch a batch job</p>
<div class="highlight"><pre><span></span>$ sbatch launch-notebook.sh
</pre></div>


<p>Check on the status of your job</p>
<div class="highlight"><pre><span></span>$ squeue -u <span class="nv">$USER</span>
</pre></div>


<p>If you job has launched, you will see something like this</p>
<div class="highlight"><pre><span></span>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
3759794      edu1 notebook   ra2697  R      34:12      1 node163
</pre></div>


<h3>Connect to your notebook</h3>
<p>Our notebook is now running on the compute node. The only problem is, we can't
connect to it! Compute nodes are hidden behind a firewall and can't accept
incomming connections. We need to use an ssh tunnel. An ssh tunnel allows us
to connect to a remote port via an ssh connection, as illustrated in this
diagram</p>
<p><img alt="SSH tunnel" src="https://webdevolutions.blob.core.windows.net/blog/2016/11/SSH-Tunnel-access-protected-server-diagram21.png"></p>
<p>First we need to find out the hostname where the notebook is running. We get
this from the <code>squeue</code> command, under the nodelist column. The hostname is
<code>node163</code>. Then we need to know the remote port where the job is running.
By default this is <code>8888</code>, but, if there are other notebook servers on the same
node, it may be different. To check for sure, we can look in the log file
from our batch job. In this case it is a file called <code>slurm-3759794.out</code>. We
type</p>
<div class="highlight"><pre><span></span>$ grep Notebook slurm-&lt;JOBID&gt;.out
</pre></div>


<p>(replace <JOBID> with your actual job ID.)</p>
<p>This gives</p>
<div class="highlight"><pre><span></span>[I 09:17:30.525 NotebookApp] Serving notebooks from local directory: /rigel/home/ra2697
[I 09:17:30.525 NotebookApp] 0 active kernels
[I 09:17:30.525 NotebookApp] The Jupyter Notebook is running at:
[I 09:17:30.526 NotebookApp] http://[all ip addresses on your system]:8888/
[I 09:17:30.526 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
</pre></div>


<p>The second to last line shows that port 8888 is correct.</p>
<p>Now, <em>from our local machine</em>, we create a new ssh connection with tunnels</p>
<div class="highlight"><pre><span></span>$ ssh -L <span class="m">9999</span>:node163:8888 &lt;UNI&gt;@habanero.rcs.columbia.edu
</pre></div>


<p>We can open the notebook connection at <a href="http://localhost:9999">http://localhost:9999</a>.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="./running-jupyter-notebooks-on-habanero.html">Running Jupyter Notebooks on Habanero</a></li>
    <li class="list-group-item"><a href="./dask-for-parallel-computing-and-big-data.html">Dask for Parallel Computing and Big Data</a></li>
    <li class="list-group-item"><a href="./assignment-11-mpi-for-python-on-habanero.html">Assignment #11 - MPI for Python on Habanero</a></li>
    <li class="list-group-item"><a href="./introduction-to-the-habanero-hpc-cluster.html">Introduction to the Habanero HPC Cluster</a></li>
    <li class="list-group-item"><a href="./parallel-programming-with-mpi-for-python.html">Parallel Programming with MPI For Python</a></li>
    <li class="list-group-item"><a href="./assignment-10-packaging-python-code.html">Assignment #10 - Packaging Python Code</a></li>
    <li class="list-group-item"><a href="./organization-and-packaging-of-python-projects.html">Organization and Packaging of Python Projects</a></li>
    <li class="list-group-item"><a href="./assignment-9-map-making-and-geomapapp.html">Assignment #9 -  Map Making and GeoMapApp</a></li>
    <li class="list-group-item"><a href="./intro-to-basemap.html">Map making in Python with Basemap</a></li>
    <li class="list-group-item"><a href="./final-project-instructions.html">Final Project Instructions</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group " id="tags">
    <li class="list-group-item tag-1">
      <a href="./tag/unix.html">unix</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/file-system.html">file system</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/programming.html">programming</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/assignment.html">assignment</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/bash.html">bash</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/shell.html">shell</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/pandas.html">pandas</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/gmt.html">GMT</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/visualization.html">visualization</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/xarray.html">xarray</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/fortran.html">fortran</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/cluster.html">cluster</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/matlab.html">MATLAB</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/parallel-computing.html">parallel computing</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/habanero.html">habanero</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/git.html">git</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/vpn.html">vpn</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/mapping.html">mapping</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/github.html">github</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/basemap.html">basemap</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/source-code-editor.html">source code editor</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/project.html">project</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/geomapapp.html">GeoMapApp</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/packaging.html">packaging</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/arrays.html">arrays</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/mpi.html">mpi</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/parallel-programming.html">parallel programming</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/final.html">final</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/numpy.html">numpy</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/version-control.html">version control</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/dask.html">dask</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/ndarray.html">ndarray</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Ryan Abernathey and Kerry Key
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./theme/js/bodypadding.js"></script>


</body>
</html>