<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Intro to Fortran - Research Computing in Earth Sciences</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./intro-to-fortran.html">

        <meta name="author" content="Kerry Key" />
        <meta name="keywords" content="fortran" />
        <meta name="description" content="Introduction to Fortran" />

        <meta property="og:site_name" content="Research Computing in Earth Sciences" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Intro to Fortran"/>
        <meta property="og:url" content="./intro-to-fortran.html"/>
        <meta property="og:description" content="Introduction to Fortran"/>
        <meta property="article:published_time" content="2017-09-28" />
            <meta property="article:section" content="lectures" />
            <meta property="article:tag" content="fortran" />
            <meta property="article:author" content="Kerry Key" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.lumen.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Research Computing in Earth Sciences            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/schedule.html">
                             Schedule
                          </a></li>
                         <li><a href="./pages/syllabus.html">
                             Syllabus
                          </a></li>
                        <li >
                            <a href="./category/assignments.html">Assignments</a>
                        </li>
                        <li class="active">
                            <a href="./category/lectures.html">Lectures</a>
                        </li>
                        <li >
                            <a href="./category/software.html">Software</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./intro-to-fortran.html"
                       rel="bookmark"
                       title="Permalink to Intro to Fortran">
                        Intro to Fortran
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-09-28T00:00:00-05:00"> Thu 28 September 2017</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/fortran.html">fortran</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Fortran is a powerful language for creating  fast and memory efficient codes for heavy numerical  computations. However, it is also a more verbose language than Python and MATLAB, so it generally will take you much longer to write Fortran codes compared to an equivalent code in Python and MATLAB. Also, unlike MATLAB and Python which can easily be run interactively, Fortran codes must be compiled before you can run them in a terminal shell. That makes debugging and testing a bit slower too.  Finally, Fortran doesn't have a built-in graphics library, so you can't interactively plot results like you can with MATLAB and Python. So with those points in mind, we recommend you stick to MATLAB and Python for you day-to-day scientific computing tasks. However,  Fortran is good when you have some computational problem where you need it to run as fast as possible, for example when it would take days to run on MATLAB or Python. Learning the basics of Fortran will also be useful for when you come across  Fortran codes that do some computational task you need and you  want to interface those codes with your own codes or you might want to modify them for your own research needs.</p>
<p><strong>Programs</strong></p>
<p>Fortran is a procedural language where you define a sequence of commands to execute in a program file. The program file is then compiled using a Fortran compiler. The compiler turns the program commands in the text file  into machine language instructions that will execute on the computer's CPU.  You  run the compiled code from a terminal shell.  </p>
<p>Let's begin by looking at a  simple example showing the basic workflow for using Fortran. Start by making  a plain text file named <code>HelloWorld.f90</code> that has the following content:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">HelloWorld</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Hello world&#39;</span>
<span class="k">end program </span><span class="n">HelloWorld</span>
</pre></div>


<p>Compile the code using the command</p>
<div class="highlight"><pre><span></span>$ gfortran HelloWorld.f90 -o HelloWorld
</pre></div>


<p>Run the code in the terminal using</p>
<div class="highlight"><pre><span></span>$ ./HelloWorld
Hello World
</pre></div>


<p>A Fortran program has to have a single <code>program</code> file that lists the sequence of commands to execute. The program file has to start with the first command being the word <code>program</code> and it must end with the last command being the keyword <code>end</code>. The words <code>program HelloWorld</code> after the final   <code>end</code> statement aren't necessary, but they are a  useful organization construct for pointing out what exactly is ending, especially when your program file is very long and also contains subroutine and function code beneath the  <code>program</code> section.</p>
<p><strong>Compiling</strong></p>
<p>In the example above, we compiled the code by calling our compiler, here the <em>gfortran</em> compiler which is open source and freely available.  Intel's <em>ifort</em> compiler is a commercial compiler that is fairly ubiquitous, especially on cluster systems. For some codes, ifort can produce an executable that runs 10-20x faster than what gfortran produces.</p>
<p>To compile our HelloWorld.f90 code, we used the output flag <code>-o</code> and then listed the name we wanted to use for the compiled program that was output. Here we used HelloWorld for the name, but if for some (not recommended!) reason we wanted to name it MyProgram instead, we could compile it using</p>
<div class="highlight"><pre><span></span>$ gfortran HelloWorld.f90 -o MyProgram
</pre></div>


<p>If you don't specify <code>-o</code> and the output program name, then the compiler will by default name the program  <code>a.out</code>.</p>
<p>If there are any errors with your code, the compiler should let you know what the problem is. For example, try compiling the code below, which has an errant 'a' character:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">HelloWorld</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Hello World&#39;</span>
<span class="n">a</span>
<span class="k">end program </span><span class="n">HelloWorld</span>
</pre></div>


<p>The compiler returns an error message:</p>
<div class="highlight"><pre><span></span>$ gfortran HelloWorld.f90
HelloWorld.f90:3:0:

 a

Error: Unclassifiable statement at <span class="o">(</span><span class="m">1</span><span class="o">)</span>
</pre></div>


<p>The statement <code>HelloWorld.f90:3:0:</code> specifies that the 'unclassifiable statement' is in file HelloWorld.f90 on line 3, column 0. It then prints out what is on that line (here the errant letter a). When there are errors in long and complicated Fortran codes, the first error the compiler finds can lead it to  other errors which stem from it not being able to interpret the code that had the first error. So if you get more than one error message when compiling a code, go fix the first listed error and try recompiling the code to see if the other errors are now gone.</p>
<p><strong>Comments</strong></p>
<p>Anything to the right of an exclamation point <code>!</code> in a Fortran code is considered a comment. For example a commented version of our HelloWorld.f90 program is</p>
<div class="highlight"><pre><span></span><span class="c">!</span>
<span class="c">! This program writes &#39;Hello world&#39; to the shell.</span>
<span class="c">! Version 0.1, September 27, 2017</span>
<span class="c">!</span>
<span class="k">program </span><span class="n">HelloWorld</span>

<span class="c">!</span>
<span class="c">! Send a message to the world:</span>
<span class="c">!</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Hello world&#39;</span>

<span class="c">!</span>
<span class="c">! All done, goodbye</span>
<span class="c">!</span>
<span class="k">end program </span><span class="n">HelloWorld</span>
</pre></div>


<p>We haven't talked much about writing comments in your codes, but they are an essential part of good coding practice. You can use them to document what each section of a code does; this can be very helpful for when you return to a code you wrote a long time ago and are trying to remember what it does, or when you get someone else's code and are trying to understand what it does. You can also use code comments as an outline when first starting to write a long and complicated code. The comments can outline  the sequence of steps you intend the code to do. Once your outline is complete, you can start coding by filling in the necessary commands below each section of comments.</p>
<p>At a minimum, your code should have at least a few comments at the start of the text file that indicates what the codes does. This is also a place where you can add a date stamp and possibly a version number. You can also list the authorship of the code, which can be useful if it will be shared with other or is part of a collaborative effort .</p>
<p><strong>Variables</strong></p>
<p>Unlike MATLAB and Python, Fortran requires you to declare the type of each variable. For example, you need to declare whether a variable is an <code>integer</code>, <code>real</code>, <code>complex</code>, <code>logical</code> or <code>character</code>. Here is an example program declaring several different variable types:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">VariableShowcase</span>

<span class="k">implicit none</span>

<span class="c">! Declare variables:</span>
<span class="kt">integer</span>         <span class="kd">::</span> <span class="n">i</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">x</span>
<span class="kt">complex</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">z</span>
<span class="kt">logical</span>         <span class="kd">::</span> <span class="nb">bTest</span>
<span class="kt">character</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">sFileName</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">z</span> <span class="o">=</span> <span class="nb">cmplx</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)</span>
<span class="nb">bTest</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>    <span class="c">! logical types are .true. or .false.</span>
<span class="n">sFileName</span> <span class="o">=</span> <span class="s1">&#39;data.txt&#39;</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;i: &#39;</span><span class="p">,</span> <span class="n">i</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;x: &#39;</span><span class="p">,</span> <span class="n">x</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;z: &#39;</span><span class="p">,</span> <span class="n">z</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;bTest: &#39;</span><span class="p">,</span> <span class="nb">bTest</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;sFileName: &#39;</span><span class="p">,</span> <span class="n">sFileName</span>

<span class="k">end program </span><span class="n">VariableShowcase</span>
</pre></div>


<p>Compile and run this demo:</p>
<div class="highlight"><pre><span></span>$ gfortran VariableShowcase.f90 -o VariableShowcase<span class="p">;</span> ./VariableShowcase
</pre></div>


<p>Note that the variable declarations in Fortran have to be made at the start of the program (or subroutine or function), before any commands are made. Unlike Python, you can't declare a new variable in the middle of a sequence of commands.  If you try to, the compiler will throw an error message.</p>
<p><strong>Fortran is case insensitive</strong></p>
<p>Fortran is case insensitive, meaning that it will treat variables <code>x</code> and <code>X</code> as the same quantity.</p>
<table class="table table-striped table-hover">
<thead>
<tr>
<th>Fortran</th>
<th>Python</th>
<th>MATLAB</th>
</tr>
</thead>
<tbody>
<tr>
<td>case insensitive</td>
<td>case sensitive</td>
<td>case sensitive</td>
</tr>
</tbody>
</table>
<p><strong>Variable Precision</strong></p>
<p><code>real(8)</code> declared above means a real variable that has 8 bytes (64 bits) of precision. This is what is known as <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">double precision</a>, which is  the default precision in MATLAB and Python.  You can also declare a lower or higher order precision (e.g. <code>real(4)</code> and <code>real(16)</code>) but you should only do this if you have a very good reason to do so. 99.99% of the time you should just use <code>real(8)</code> rather than (4) or (16). The <code>complex(8)</code> declaration means a complex number with 8 bytes of precision for each of the real and imaginary parts of the number. For integers, you typically  don't need to specify the precision and most of the time you can just use <code>integer</code> and then let the compiler assign the precision (usually either 4 or 8 bytes).</p>
<p>You can use the <code>huge()</code> intrinsic function to show the largest numbers that can be represented by each precision. For example, compile and run this code to see the largest possible values that can be represented by each numerical variable type:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">PrecisionTest</span>

<span class="k">implicit none</span>

<span class="c">! Declare variables:</span>
<span class="kt">integer</span>         <span class="kd">::</span> <span class="n">i</span>
<span class="kt">integer</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">i4</span>
<span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">i8</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">x4</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">x8</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;integer:    &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;integer:    &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;integer(4): &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">i4</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;integer(8): &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">i8</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;real(4):    &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">x4</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;real(8):    &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">x8</span><span class="p">)</span>

<span class="k">end program </span><span class="n">PrecisionTest</span>
</pre></div>


<p>In this tutorial I am using modern Fortran syntax to define the variables.  However, there are older ways of defining variables that you should be aware of since you may stumble across them. The older syntax does not use the <code>::</code> separator between the declaration and the list of variable names and has slightly different type names.   Most Fortran compilers support the older and modern syntax:</p>
<div class="highlight"><pre><span></span><span class="c">! Old style Fortran variable types:</span>
<span class="kt">double precision</span>      <span class="c">! same as real(8)</span>
<span class="kt">real</span><span class="o">*</span><span class="mi">8</span>                <span class="c">! same as real(8)</span>
<span class="kt">real</span><span class="o">*</span><span class="mi">4</span>                <span class="c">! same as real(4)</span>
<span class="kt">double complex</span>        <span class="c">! same as complex(8)</span>
<span class="kt">complex</span><span class="o">*</span><span class="mi">16</span>            <span class="c">! same as complex(8)</span>
<span class="kt">integer</span><span class="o">*</span><span class="mi">4</span>             <span class="c">! same as integer(4)</span>
</pre></div>


<p><strong>Integer Division</strong></p>
<p>Be careful when dividing integers in Fortran. For example, the expression <code>fraction = (N-1)/N</code> where <code>N</code> is an integer and <code>fraction</code> has been declared as <code>real(8)</code> will result in <code>fraction</code> being assigned the value 0. Why is this? Because all the terms in <code>(N-1)/N</code> are integers so the compiler uses integer division. You can easily fix this by making at least one of the terms in the expression a floating point number. Either of the following expressions will force the compiler to use floating point arithmetic and <code>fraction</code> will then be assigned the intended value:</p>
<div class="highlight"><pre><span></span><span class="nb">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
</pre></div>


<p>where the <code>dble()</code> function turns integer <code>N</code> into a double precision value.</p>
<p><strong>implicit none</strong></p>
<p><em>You should always include the statement <code>implicit none</code> at the start of your Fortran codes (programs, subroutines and functions).</em></p>
<p>By default, Fortran has a rather insidious implicit typing for variables that have certain first letters in their names.  Unless specified otherwise, all variables starting with letters I, J, K, L, M and N are default integers, and all others are default real. This can lead to nasty programming errors if you aren't careful. For example, consider the following code:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">ImplicitTypeTest</span>

<span class="n">ireal</span> <span class="o">=</span> <span class="mf">1.5</span>   <span class="c">! we want this to be a real number, but since the variable</span>
              <span class="c">! name starts with an i Fortran thinks its an integer.</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ireal is: &#39;</span><span class="p">,</span> <span class="n">ireal</span>

<span class="k">end program </span><span class="n">ImplicitTypeTest</span>
</pre></div>


<p>Try running this program and you will see that it prints out ireal as the integer 1. If instead, you use <code>implicit none</code> at the start of this code, the compiler will issue an error because <code>ireal</code> was not yet declared.  If we had instead used <code>implicit none</code> at the start of the code, the compiler would have warned us that <code>ireal</code> was undeclared.</p>
<p>Here's another example where <code>implicit none</code> would help avoid getting the wrong result. Can you spot the error?  </p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">TestUndeclared</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">distance</span><span class="p">,</span> <span class="n">velocity</span><span class="p">,</span> <span class="nb">time</span>

<span class="nb">time</span>     <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">velocity</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="n">distance</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">*</span><span class="n">times</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;distance: &#39;</span><span class="p">,</span> <span class="n">distance</span>

<span class="k">end program </span><span class="n">TestUndeclared</span>
</pre></div>


<p><strong>Relational operators</strong></p>
<table class="table table-striped table-hover">
<thead>
<tr>
<th>Older Fortran</th>
<th>Newer Fortran</th>
<th>Python</th>
<th>MATLAB</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>.eq.</td>
<td>==</td>
<td>==</td>
<td>==</td>
<td>equality</td>
</tr>
<tr>
<td>.ne.</td>
<td>/=</td>
<td>!=</td>
<td>~=</td>
<td>not equality</td>
</tr>
<tr>
<td>.lt.</td>
<td>&lt;</td>
<td>&lt;</td>
<td>&lt;</td>
<td>less than</td>
</tr>
<tr>
<td>.le.</td>
<td>&lt;=</td>
<td>&lt;=</td>
<td>&lt;=</td>
<td>less than or equal to</td>
</tr>
<tr>
<td>.gt.</td>
<td>&gt;</td>
<td>&gt;</td>
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr>
<td>.ge.</td>
<td>&gt;=</td>
<td>&gt;=</td>
<td>&gt;=</td>
<td>greater than or equal to</td>
</tr>
<tr>
<td>.and.</td>
<td>.and.</td>
<td>and</td>
<td>&amp;</td>
<td>logical and</td>
</tr>
<tr>
<td>.or.</td>
<td>.or.</td>
<td>or</td>
<td>|</td>
<td>logical or</td>
</tr>
<tr>
<td>.not.</td>
<td>.not.</td>
<td>not</td>
<td>~</td>
<td>logical not</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">TestRelationalOps</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
<span class="kt">logical</span> <span class="kd">::</span> <span class="n">ltest1</span><span class="p">,</span> <span class="n">ltest2</span><span class="p">,</span> <span class="n">ltest3</span>

<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">z</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">ltest1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span>
<span class="n">ltest2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">z</span>
<span class="n">ltest3</span> <span class="o">=</span> <span class="p">(</span><span class="n">ltest1</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">ltest2</span><span class="p">)</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ltest1: &#39;</span><span class="p">,</span> <span class="n">ltest1</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ltest2: &#39;</span><span class="p">,</span> <span class="n">ltest2</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ltest3: &#39;</span><span class="p">,</span> <span class="n">ltest3</span>

<span class="k">end program </span><span class="n">TestRelationalOps</span>
</pre></div>


<p><strong>if statements</strong></p>
<p>These are similar to MATLAB and Python, except that  the logical or relational statements need to be in parentheses and you need to include the keyword <code>then</code> after the logical statement. The <code>if</code> statement also ends with the keyword <code>endif</code>.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span> <span class="k">then</span>
<span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;x is less than y&#39;</span>
<span class="n">elseif</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;x is greater than y&#39;</span>
<span class="n">elseif</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;x equals y&#39;</span>
<span class="k">else</span>
<span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;this case should never be found&#39;</span>      
<span class="n">endif</span>
</pre></div>


<p><strong>do loops</strong></p>
<p>Loops in Fortran are done using the <code>do</code> <code>enddo</code> construct:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">DoLoopTest</span>
<span class="k">implicit none</span>

<span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;i is &#39;</span><span class="p">,</span> <span class="n">i</span>
<span class="n">enddo</span>

<span class="k">end program </span><span class="n">DoLoopTest</span>
</pre></div>


<p>Note that unlike Python, you don't need to indent the commands inside the <code>do</code> <code>enddo</code> construct. However, it helps to make your code much more readable if you do indent the commands. Indenting is also super helpful if you loop has spans a page or more of code, since the indentation is a visual guide to the scope of the loop. Indenting is also helpful when you have nested loops. For example, both of these loops below are valid Fortran, but which one is easier to read?</p>
<div class="highlight"><pre><span></span><span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">l</span>
<span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">m</span>
<span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<span class="n">enddo</span>
<span class="n">endo</span>
<span class="n">enddo</span>

<span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">l</span>
  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">m</span>
    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span>
      <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
    <span class="n">enddo</span>
  <span class="n">endo</span>
<span class="n">enddo</span>
</pre></div>


<p>You can change the increment for a do loop using the syntax <code>start,stop,increment</code>. Also, Fortran is like MATLAB where the loop is inclusive over the stop value. This is in contrast to Python, which is exclusive for the stop value (meaning Python counts up to but not including the stop value).</p>
<div class="highlight"><pre><span></span><span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">5</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">i</span>
<span class="n">enddo</span>
</pre></div>


<p><strong>do while loops</strong></p>
<p>The <code>do while</code> loop is similar but instead of using a counter, it uses a logical variable to exit the loop.</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">DoWhileTest</span>

<span class="k">implicit none</span>

<span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">iCounter</span>
<span class="kt">logical</span> <span class="kd">::</span> <span class="n">lKeepGoing</span>

<span class="n">lKeepGoing</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="n">iCounter</span>   <span class="o">=</span> <span class="mi">0</span>

<span class="k">do while</span> <span class="p">(</span><span class="n">lKeepGoing</span><span class="p">)</span>

  <span class="n">iCounter</span> <span class="o">=</span> <span class="n">iCounter</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iCounter: &#39;</span><span class="p">,</span><span class="n">iCounter</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">iCounter</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span> <span class="n">lKeepGoing</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>

<span class="n">enddo</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;All done&#39;</span>

<span class="k">end program </span><span class="n">DoWhileTest</span>
</pre></div>


<p><strong>arrays</strong></p>
<p>The modern way of declaring a fixed size array in Fortran is to use the <code>dimension()</code> keyword. For example:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">TestArray</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xArray</span>
<span class="kt">integer</span>                <span class="kd">::</span> <span class="n">i</span>

<span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">xArray</span><span class="p">)</span>
  <span class="n">xArray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">*</span><span class="n">i</span>
<span class="n">enddo</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;xArray: &#39;</span><span class="p">,</span> <span class="n">xArray</span>

<span class="k">end program </span><span class="n">TestArray</span>
</pre></div>


<p>Arrays can have multiple dimensions, otherwise referred to as the rank of the array. The Fortran2008 standard allows up to rank 15, whereas the previous standard only allowed a maximum rank of 7. Here are some examples:</p>
<div class="highlight"><pre><span></span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">xArray1D</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">xArray2D</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">xArray3D</span>
<span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xArray4D</span>
</pre></div>


<p>You can get the length or size of any dimension of the array using the <code>size(array,dim)</code> function where <code>dim</code> is an integer for the dimension you want to measure. For example we can write out the lengths of all four dimensions of <code>xArray4D</code> that was defined above using the commands:</p>
<div class="highlight"><pre><span></span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;The four dimensions of xArray4D have lengths: &#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>


<p>Note that that line is quite long, we can use the <em>continuation</em> character <code>&amp;</code> to break that command into multiple lines using:</p>
<div class="highlight"><pre><span></span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;The four dimensions of xArray4D have lengths: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>  
<span class="p">&amp;</span> <span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">xArray4D</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>


<p><strong>allocatable arrays</strong></p>
<p>The arrays above are fixed dimensional, meaning that we declared their sizes in the declaration statements.  A more flexible construct is the allocatable array. The arrays you have already seen in Python and MATLAB were allocatable arrays, but you didn't need to do anything special to create them. In Fortran you need to explicitly declare them using the <code>allocatable</code> keyword.</p>
<div class="highlight"><pre><span></span><span class="kt">integer</span>                             <span class="kd">::</span> <span class="n">m</span><span class="p">,</span><span class="n">n</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span>   <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">xArray1D</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">xArray2D</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">allocate</span><span class="p">(</span><span class="n">xArray1D</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="k">allocate</span><span class="p">(</span><span class="n">xArray2D</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</pre></div>


<p>You can then assign values to the elements of the arrays.</p>
<p>If you need to free up memory later on in your program, you can <code>deallocate</code> the arrays:</p>
<div class="highlight"><pre><span></span><span class="k">deallocate</span><span class="p">(</span><span class="n">xArray1D</span><span class="p">,</span> <span class="n">xArray2D</span><span class="p">)</span>
</pre></div>


<p>You can use the  <code>size</code> command to get their lengths in each dimension:</p>
<div class="highlight"><pre><span></span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">size</span><span class="p">(</span><span class="n">xArray2D</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>   <span class="c">! returns the size of the 1st dimension</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">size</span><span class="p">(</span><span class="n">xArray2D</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>   <span class="c">! returns the size of the 2nd dimension</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">size</span><span class="p">(</span><span class="n">xArray2D</span><span class="p">)</span>     <span class="c">! returns the total number of elements (m*n in this example)</span>
</pre></div>


<p>There is another type of array called an <em>automatic</em> array, but we won't discuss those until we get to the subroutine section below.</p>
<p><strong>Reading and writing data from the terminal</strong></p>
<p>We've already seen some writing commands in action in the code snippets above. Now lets look at reading and writing data in a little bit more detail.</p>
<div class="highlight"><pre><span></span><span class="k">write</span><span class="p">(</span><span class="n">unit</span><span class="err">#</span><span class="p">,</span> <span class="k">format</span><span class="p">,</span> <span class="k">options</span><span class="p">)</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item</span> <span class="mi">2</span><span class="p">,...</span>
<span class="k">read</span><span class="p">(</span><span class="n">unit</span><span class="err">#</span><span class="p">,</span> <span class="k">format</span><span class="p">,</span> <span class="k">options</span><span class="p">)</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="p">,...</span>
</pre></div>


<p>The <code>unit#</code> is an integer which tells Fortran where to read or write teh data from. Standard Fortran reserves two unit numbers for I/O to user. They are:</p>
<div class="highlight"><pre><span></span>     <span class="n">UNIT</span> <span class="o">=</span> <span class="mi">5</span>   <span class="n">for</span> <span class="n">input</span> <span class="n">from</span> <span class="n">the</span> <span class="n">keyboard</span> <span class="n">with</span> <span class="n">the</span> <span class="k">READ </span><span class="n">statement</span>

     <span class="n">UNIT</span> <span class="o">=</span> <span class="mi">6</span>   <span class="n">for</span> <span class="n">output</span> <span class="n">to</span> <span class="n">the</span> <span class="n">screen</span> <span class="n">with</span> <span class="n">the</span> <span class="k">WRITE </span><span class="n">statement</span>
</pre></div>


<p>However, you can also use the asterisk <code>*</code> instead of having to specify units 5 and 6 and this will have the input and  output be done from the terminal shell. For example, to ask a question and read the answer, we can use</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">AskQuestion</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">number</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;What is your favorite number?&#39;</span>
<span class="k">read</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">number</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;You entered &#39;</span><span class="p">,</span> <span class="n">number</span>

<span class="k">end program </span><span class="n">AskQuestion</span>
</pre></div>


<p><strong>Reading and writing data from a file</strong></p>
<p>To read or write data from a file, you need to first open the file using the <code>open()</code> command. When you are done, you use the <code>close()</code> command. For example, to read data from an existing file:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">FileReadTest</span>

<span class="kt">integer</span>                            <span class="kd">::</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>

<span class="c">! Open the file:</span>
<span class="k">open</span><span class="p">(</span><span class="n">newunit</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>

<span class="c">! The first line of the file has the number of values for arrays a and b:</span>
<span class="k">read</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">n</span>

<span class="c">! Allocate the arrays:</span>
<span class="k">allocate</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">b</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="c">! Read in the values using an inline expression:</span>
<span class="k">read</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="c">! or you could use a do loop:</span>
<span class="c">! do i = 1,n</span>
<span class="c">!   read(u, *) a(i), b(i)</span>
<span class="c">! enddo</span>
<span class="c">!</span>

<span class="c">! Close the file:</span>
<span class="k">close</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

<span class="c">! Display the values:</span>
<span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">enddo</span>

<span class="k">end program </span><span class="n">FileReadTest</span>
</pre></div>


<p>A few comments on this code. First, the Fortran2008 standard introduced the <code>newunit</code> keyword, which automatically creates a file unit number when you open a file. Here, the variable <code>u</code> is assigned the new unit number. In previous versions of Fortran, you has to pick a number (usually an integer between 10 - 100) and assign that as the file unit. It's much easier and better to have Fortran pick the number for you (like MATLAB and Python) and then you use that unit number for all read or write commands to the file, rather than having to refer to it by the filename each time. <code>status = 'old'</code> tells Fortran that the file exists already. This is optional, but can be helpful since if the file doesn't exist, Fortran will issue a helpful error message.</p>
<p>For the read commands, here we are using the asterisk <code>*</code> to denote a free-format read, which means that Fortran will decide what the format is.</p>
<p>Now lets look at writing to a file. Suppose the code above  modified the values in arrays <code>a</code> and <code>b</code>. We could then save the modified values to a new file using:</p>
<div class="highlight"><pre><span></span><span class="k">open</span><span class="p">(</span><span class="n">newunit</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;newlog.txt&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="k">close</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>


<p>If we want to append the values to an existing file, we could use:</p>
<div class="highlight"><pre><span></span><span class="k">open</span><span class="p">(</span><span class="n">newunit</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
<span class="k">close</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>


<p><strong>Format specifiers</strong></p>
<p>In all of our read and write examples above we used the generic <code>*</code> for the format specifier. When writing, Fortran will write out the full precision of each floating point number. For example: 0.65569999999999995.  You can use the format specifier to specify another format. We don't have time to go into the details of format specifiers here, but you can look them up online. In Fortran, they are often referred to as "edit descriptors". Here are a few examples:</p>
<div class="highlight"><pre><span></span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">123</span><span class="mf">4.1234567890</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>  <span class="s1">&#39;the number is&#39;</span><span class="p">,</span><span class="n">x</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(a,1x,f6.1)&#39;</span><span class="p">)</span>  <span class="s1">&#39;the number is&#39;</span><span class="p">,</span><span class="n">x</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(a,1x,e15.3)&#39;</span><span class="p">)</span> <span class="s1">&#39;the number is&#39;</span><span class="p">,</span><span class="n">x</span>
</pre></div>


<p><code>a</code> specifies character string output, <code>1x</code> means add a space and the others are for fixed point <code>f</code> and floating point format <code>e</code> with the format <code>w.d</code> where w is the width (number of characters) and d is the number of decimal places. Try them out.</p>
<p><strong>Functions</strong></p>
<p>You can define functions using the <code>function</code> keyword.  Functions are useful when you need to do a complicated calculation that has only one result.
 Functions need to be either in a separate .f90 file or have to be listed outside the main program. For example:</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">FunctionTest</span>

<span class="k">implicit none</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">myFunction</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">myFunction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;c is: &#39;</span><span class="p">,</span> <span class="n">c</span>

<span class="k">end program </span><span class="n">FunctionTest</span>

<span class="c">!-----------------------------------</span>
<span class="c">! This is the external function:</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">function </span><span class="n">myFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>  

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
<span class="n">myFunction</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>

<span class="k">end function </span><span class="n">myFunction</span>
<span class="c">!-----------------------------------</span>
</pre></div>


<p><strong>Subroutines</strong></p>
<p>Use a subroutine to break your code up unto various sections that are easier to read. Subroutines are like functions, but the I/O is all done as arguments after the subroutine name.</p>
<div class="highlight"><pre><span></span><span class="k">program </span><span class="n">SubRoutineTest</span>

<span class="k">implicit none</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="k">call </span><span class="n">subroutineA</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>  <span class="c">! a and b are input, c is returned</span>
<span class="k">call </span><span class="n">subroutineB</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>  <span class="c">! a,b and c are input, d is returned</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;c is: &#39;</span><span class="p">,</span> <span class="n">c</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;d is: &#39;</span><span class="p">,</span> <span class="n">d</span>

<span class="k">end program </span><span class="n">SubRoutineTest</span>

<span class="c">!-----------------------------------</span>
<span class="k">subroutine </span><span class="n">subroutineA</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="k">implicit none</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>

<span class="k">end subroutine </span><span class="n">subroutineA</span>
<span class="c">!-----------------------------------</span>
<span class="k">subroutine </span><span class="n">subroutineB</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<span class="k">implicit none</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>

<span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">11</span><span class="n">d0</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span>

<span class="k">end subroutine </span><span class="n">subroutineB</span>
<span class="c">!-----------------------------------</span>
</pre></div>


<p><strong>Timing subroutine</strong></p>
<p>The <code>cpu_time()</code> function can be used to time sections of Fortran code.  The command <code>cpu_time(time)</code> returns the time in variable time. You need to difference two calls to this subroutine to get the time difference.</p>
<div class="highlight"><pre><span></span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span>

<span class="p">...</span>
<span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>

<span class="p">...</span> <span class="n">section</span> <span class="n">of</span> <span class="n">code</span> <span class="n">to</span> <span class="n">test</span> <span class="n">goes</span> <span class="n">in</span> <span class="n">between</span> <span class="p">...</span>

<span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_end</span><span class="p">)</span>

<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Time to run section of code:&#39;</span> <span class="p">,</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">,</span> <span class="s1">&#39; seconds&#39;</span>
</pre></div>


<p><strong>Modules</strong></p>
<p>Modern Fortran best practices are to put all subroutines and functions into one or more module files. A module file is similar to an object, if you are familiar with object oriented program. In a module you can define variables and all the actions that work on them. You can have public and private variables, subroutines and functions. Your main program can then use the modules. Variables defined at the top of a module are available to be used in any of the contained subroutines (so they are globally available).  Unfortunately we don't have time to cover modules, so look them up for more information.</p>
<p><strong>Compiler Optimization Flags</strong></p>
<p>You can specify an optimization flag when compiling a code and it will tell the compiler to spend time analyzing your code in order
to find ways to make the code run faster.  We don't have time to go into the details and all the possible optimization options, but in general using the optimization flag <code>-O2</code> results in a code that will run much faster.  You give the optimization flag right after specifying the compiler:</p>
<p>$ gfortran -O2 HelloWorld.f90 -o MyProgram</p>
<p><strong>Free and fixed form source code: the .f90 and .f extensions</strong></p>
<p>Modern Fortran uses a free form source code format and these files are specified by the .f90 extension.  The .f90 file extension is used for any codes adhering to the Fortran 2015, Fortran 2008, Fortran 2003, Fortran 95 or Fortran 90 standards.  </p>
<p>Prior to Fortran 90, Fortran was known as FORTRAN77 and used a fixed form file format specified with the .f and .for extensions. The fixed form came from the really old days when FORTRAN code was entered onto punch cards that were read by the earliest computers. Fix form  requires that you have 6 spaces at the start of each line before any commands. There is also maximum width of 72 characters for each line (including the 6 spaces). If you need extra space you can put any character in column 6 to indicate that line is a continuation of the previous line's commands.</p>
<p>Thankfully Fortran moved to using free form files with the .f90 extension. However, there is quite a bit of legacy code out there that is in the .f fixed format files.  </p>
<p><strong>Linking multiple object files</strong></p>
<p>We're out of time, so you will need to look this up online.</p>
<p><strong>Further Help</strong></p>
<p>The Fortran90 website is incredibly useful. Despite its name, it actually has recommendations for best practices that include commands up to the modern Fortran2008 standard. It also has a nice <em>Python Fortran Rosetta Stone</em> that will help Python experts translate Python commands into Fortran commands.</p>
<p><a href="http://www.fortran90.org/">http://www.fortran90.org/</a></p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="./final-project-instructions.html">Final Project Instructions</a></li>
    <li class="list-group-item"><a href="./introduction-to-generic-mapping-tools-gmt.html">Introduction to Generic Mapping Tools (GMT)</a></li>
    <li class="list-group-item"><a href="./assignment-8-xarray.html">Assignment 8 - Xarray</a></li>
    <li class="list-group-item"><a href="./xarray.html">Intermediate Python III: Xarray for Multidimensional Data</a></li>
    <li class="list-group-item"><a href="./assignment-7-pandas.html">Assignment 7 - Pandas</a></li>
    <li class="list-group-item"><a href="./pandas.html">Intermediate Python II: Pandas for Tabular Data</a></li>
    <li class="list-group-item"><a href="./assignment-6-numpy-and-matplotlib.html">Assignment 6 - Numpy and Matplotlib</a></li>
    <li class="list-group-item"><a href="./numpy-arrays-and-matplotlib.html">Intermediate Python I: NumPy arrays and matplotlib</a></li>
    <li class="list-group-item"><a href="./assignment-5-fortran.html">Assignment #5 -  Fortran</a></li>
    <li class="list-group-item"><a href="./intro-to-fortran.html">Intro to Fortran</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group " id="tags">
    <li class="list-group-item tag-1">
      <a href="./tag/file-system.html">file system</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/unix.html">unix</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/shell.html">shell</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/assignment.html">assignment</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="./tag/bash.html">bash</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/pandas.html">pandas</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="./tag/programming.html">programming</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/git.html">git</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/matlab.html">MATLAB</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/visualization.html">visualization</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/fortran.html">fortran</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="./tag/gmt.html">GMT</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/geomapapp.html">GeoMapApp</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/ndarray.html">ndarray</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/numpy.html">numpy</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/source-code-editor.html">source code editor</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/arrays.html">arrays</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/matplotlib.html">matplotlib</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/xarray.html">xarray</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/github.html">github</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/vpn.html">vpn</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/final.html">final</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/version-control.html">version control</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="./tag/project.html">project</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Ryan Abernathey and Kerry Key
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./theme/js/bodypadding.js"></script>


</body>
</html>